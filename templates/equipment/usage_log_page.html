{% extends "base.html" %}

{% block title %}사용일지{% endblock %}

{% block extra_css %}
<style>
    /* 드롭다운 화살표 중복 문제 해결 */
    .form-select {
        position: relative !important;
        z-index: 1000 !important;
        pointer-events: auto !important;
        cursor: pointer !important;
        background-color: white !important;
        border: 1px solid #ced4da !important;
        border-radius: 0.375rem !important;
        padding: 0.375rem 2.25rem 0.375rem 0.75rem !important;
        /* 브라우저 기본 화살표 제거 */
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right 0.75rem center !important;
        background-size: 16px 12px !important;
    }
    
    .form-select:hover {
        border-color: #86b7fe !important;
        cursor: pointer !important;
    }
    
    .form-select:focus {
        border-color: #0d6efd !important;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        outline: 0 !important;
    }
    
    .form-select option {
        background-color: white !important;
        color: black !important;
        padding: 0.375rem 0.75rem !important;
    }
    
    /* 카드와 폼 요소들이 드롭다운을 방해하지 않도록 설정 */
    .card {
        z-index: 1 !important;
        position: relative !important;
    }
    
    .form-group {
        position: relative !important;
        z-index: 1 !important;
    }
    
    /* 테이블이 드롭다운을 방해하지 않도록 설정 */
    .table-responsive {
        z-index: 0 !important;
    }
    
    /* 상태 배지 개선 */
    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .status-사용가능 {
        background-color: #d1edff;
        color: #0969da;
    }
    
    .status-이상있음 {
        background-color: #ffebe9;
        color: #cf222e;
    }
    
    /* 모달 디자인 개선 */
    .modal-content {
        border-radius: 0.75rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .modal-header {
        border-bottom: 1px solid #dee2e6;
        background-color: #f8f9fa;
        border-radius: 0.75rem 0.75rem 0 0;
    }
    
    .modal-footer {
        border-top: 1px solid #dee2e6;
        background-color: #f8f9fa;
        border-radius: 0 0 0.75rem 0.75rem;
    }
    
    /* 폼 레이블 개선 */
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
    }
    
    /* 버튼 디자인 개선 */
    .btn-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        border: none;
        border-radius: 0.5rem;
        padding: 0.5rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
        border: none;
        border-radius: 0.5rem;
        padding: 0.5rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }
    
    /* 테이블 디자인 개선 */
    .table {
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .table thead th {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
        color: #495057;
        padding: 1rem 0.75rem;
    }
    
    .table tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
        transition: background-color 0.2s ease;
    }
    
    /* 페이지 제목 개선 */
    .page-title {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }
    
    .page-title i {
        color: #007bff;
        margin-right: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="page-title"><i class="fas fa-clipboard-list"></i>사용일지</h2>
                <button class="btn btn-primary" id="openUsageLogModalBtn">
                    <i class="fas fa-plus"></i> 사용일지 작성
                </button>
            </div>
        </div>
    </div>

    <!-- 사용일지 작성 모달 -->
    <div class="modal fade" id="usageLogModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">사용일지 작성</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="usageLogForm">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">장비 선택 *</label>
                  <select class="form-select" id="usageEquipment" required>
                    <option value="">장비를 선택하세요</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">사용자 *</label>
                  <input type="text" class="form-control" id="usageUser" required>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">사용일 *</label>
                  <input type="date" class="form-control" id="usageDate" required>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">시작 시간 *</label>
                  <select class="form-select" id="usageStartTime" required>
                    <option value="">시작 시간 선택</option>
                    <option value="07:00">07:00</option>
                    <option value="07:30">07:30</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                    <option value="15:30">15:30</option>
                    <option value="16:00">16:00</option>
                    <option value="16:30">16:30</option>
                    <option value="17:00">17:00</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">종료 시간</label>
                  <select class="form-select" id="usageEndTime">
                    <option value="">종료 시간 선택</option>
                    <option value="07:00">07:00</option>
                    <option value="07:30">07:30</option>
                    <option value="08:00">08:00</option>
                    <option value="08:30">08:30</option>
                    <option value="09:00">09:00</option>
                    <option value="09:30">09:30</option>
                    <option value="10:00">10:00</option>
                    <option value="10:30">10:30</option>
                    <option value="11:00">11:00</option>
                    <option value="11:30">11:30</option>
                    <option value="12:00">12:00</option>
                    <option value="12:30">12:30</option>
                    <option value="13:00">13:00</option>
                    <option value="13:30">13:30</option>
                    <option value="14:00">14:00</option>
                    <option value="14:30">14:30</option>
                    <option value="15:00">15:00</option>
                    <option value="15:30">15:30</option>
                    <option value="16:00">16:00</option>
                    <option value="16:30">16:30</option>
                    <option value="17:00">17:00</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">사용 목적 *</label>
                  <textarea class="form-control" id="usagePurpose" rows="2" required></textarea>
                </div>
              </div>
              <div class="form-group mb-3">
                <label class="form-label">사용 후 상태</label>
                <select class="form-select" id="usageCondition">
                  <option value="정상">정상</option>
                  <option value="주의">주의</option>
                  <option value="이상있음">이상있음</option>
                </select>
              </div>
              <div class="form-group mb-3">
                <label class="form-label">사용 중 특이사항</label>
                <textarea class="form-control" id="usageIssues" rows="3" placeholder="사용 중 발생한 문제나 특이사항을 기록하세요"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            <button type="button" class="btn btn-primary" onclick="saveNewUsageLog()">
              <i class="fas fa-save me-2"></i>사용일지 저장
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 사용일지 목록 -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-list me-2"></i>사용일지 목록</h5>
                        <div class="d-flex gap-2">
                            <select class="form-select form-select-sm" id="filterEquipment" onchange="filterUsageLogs()" style="width: 200px;">
                                <option value="">전체 장비</option>
                            </select>
                            <input type="month" class="form-control form-control-sm" id="filterMonth" onchange="filterUsageLogs()" style="width: 150px;">
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th>날짜</th>
                                    <th>장비명</th>
                                    <th>사용자</th>
                                    <th>시작시간</th>
                                    <th>종료시간</th>
                                    <th>목적</th>
                                    <th>상태</th>
                                    <th>특이사항</th>
                                    <th>액션</th>
                                </tr>
                            </thead>
                            <tbody id="usageLogTableBody">
                                <!-- 사용일지 목록이 여기에 동적으로 로드됩니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    loadNewUsageLogs();
    loadEquipmentForUsage(); // 장비 목록 미리 로드
    
    // 드롭다운 클릭 문제 해결을 위한 강제 이벤트 핸들러
    setTimeout(() => {
        const usageEquipmentSelect = document.getElementById('usageEquipment');
        const filterEquipmentSelect = document.getElementById('filterEquipment');
        const usageConditionSelect = document.getElementById('usageCondition');
        
        // 클릭 이벤트 강제 바인딩
        [usageEquipmentSelect, filterEquipmentSelect, usageConditionSelect].forEach(select => {
            if (select) {
                // 기본 클릭 이벤트 보장
                select.addEventListener('click', function(e) {
                    console.log('드롭다운 클릭됨:', this.id);
                    e.stopPropagation();
                    this.focus();
                    // 브라우저 기본 드롭다운 동작 강제 실행
                    if (this.size === 1) {
                        this.size = Math.min(this.options.length, 10);
                        setTimeout(() => {
                            this.size = 1;
                        }, 100);
                    }
                });
                
                // 마우스오버 시 커서 포인터 확실히 설정
                select.addEventListener('mouseenter', function() {
                    this.style.cursor = 'pointer';
                });
                
                // 포커스 이벤트
                select.addEventListener('focus', function() {
                    console.log('드롭다운 포커스됨:', this.id);
                });
                
                // 터치 이벤트 (모바일 대응)
                select.addEventListener('touchstart', function(e) {
                    console.log('드롭다운 터치됨:', this.id);
                    this.focus();
                });
            }
        });
    }, 1000);

    const usageLogBtn = document.getElementById('openUsageLogModalBtn');
    if (usageLogBtn) {
        usageLogBtn.onclick = function() {
            // 폼 초기화
            document.getElementById('usageLogForm').reset();
            setCurrentDateTime();
            // 저장 버튼을 신규 작성 모드로 복구
            const saveBtn = document.querySelector('#usageLogModal .btn-primary');
            saveBtn.onclick = saveNewUsageLog;
            // 모달 열기
            const modal = new bootstrap.Modal(document.getElementById('usageLogModal'));
            modal.show();
        };
    }
    
    // 시간 검증 이벤트 리스너 추가
    const startTimeSelect = document.getElementById('usageStartTime');
    const endTimeSelect = document.getElementById('usageEndTime');
    
    if (startTimeSelect && endTimeSelect) {
        startTimeSelect.addEventListener('change', validateTimeRange);
        endTimeSelect.addEventListener('change', validateTimeRange);
    }
    
    function validateTimeRange() {
        const startTime = startTimeSelect.value;
        const endTime = endTimeSelect.value;
        
        if (startTime && endTime) {
            if (startTime >= endTime) {
                endTimeSelect.setCustomValidity('종료 시간은 시작 시간보다 늦어야 합니다.');
            } else {
                endTimeSelect.setCustomValidity('');
            }
        }
    }
});

// 새로운 사용일지 함수들
function loadNewUsageLogs() {
    loadUsageLogsData();
    loadEquipmentForUsage();
    setCurrentDateTime();
}

async function loadUsageLogsData() {
    try {
        const response = await fetch('/equipment/api/usage-logs');
        const data = await response.json();
        
        if (data.success) {
            // API 응답 구조에 맞게 수정: data.data.logs
            const logsList = data.data?.logs || data.logs || [];
            renderNewUsageLogTable(logsList);
        }
    } catch (error) {
        console.error('사용일지 로드 중 오류:', error);
    }
}

async function loadEquipmentForUsage() {
    try {
        const response = await fetch('/equipment/api/equipment');
        const data = await response.json();
        console.log('사용일지 장비 API 응답:', data); // 디버깅용
        
        const select = document.getElementById('usageEquipment');
        const filterSelect = document.getElementById('filterEquipment');
        select.disabled = false;
        
        let html = '<option value="">장비를 선택하세요</option>';
        let filterHtml = '<option value="">전체 장비</option>';
        
        // API 응답 구조에 맞게 수정: data.data.equipment
        const equipmentList = data.data?.equipment || data.equipment || [];
        
        if (data.success && equipmentList && equipmentList.length > 0) {
            console.log('사용일지 장비 개수:', equipmentList.length); // 디버깅용
            equipmentList.forEach(equipment => {
                console.log('사용일지 장비 정보:', equipment); // 디버깅용
                
                // 모든 장비를 표시하되, 사용 불가능한 장비는 비활성화
                const isUsable = !equipment.status || 
                                equipment.status === '사용가능' || 
                                equipment.status === '사용 가능' || 
                                equipment.status === '사용가능' ||
                                equipment.status === '정상';
                const statusText = equipment.status || '상태 없음';
                
                html += `<option value="${equipment.name}"${isUsable ? '' : ' disabled'}>${equipment.name} (${equipment.model || '모델명 없음'}) - ${statusText}</option>`;
                filterHtml += `<option value="${equipment.name}">${equipment.name} (${equipment.model || '모델명 없음'}) - ${statusText}</option>`;
            });
        } else {
            console.log('사용일지 장비 데이터가 없거나 잘못된 형식:', data); // 디버깅용
            html += '<option value="" disabled>등록된 장비 없음</option>';
            filterHtml += '<option value="" disabled>등록된 장비 없음</option>';
        }
        
        select.innerHTML = html;
        filterSelect.innerHTML = filterHtml;
    } catch (error) {
        console.error('사용일지 장비 목록 로드 오류:', error);
        const select = document.getElementById('usageEquipment');
        const filterSelect = document.getElementById('filterEquipment');
        select.innerHTML = '<option value="" disabled>장비 목록 로드 오류</option>';
        filterSelect.innerHTML = '<option value="" disabled>장비 목록 로드 오류</option>';
        select.disabled = true;
    }
}

function setCurrentDateTime() {
    const now = new Date();
    const today = now.toISOString().split('T')[0];
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    // 현재 시간을 30분 간격으로 반올림
    let roundedHour = currentHour;
    let roundedMinute = currentMinute >= 30 ? 30 : 0;
    
    // 17시를 넘으면 17:00으로 설정
    if (roundedHour >= 17) {
        roundedHour = 17;
        roundedMinute = 0;
    }
    // 7시 이전이면 09:00으로 설정
    else if (roundedHour < 7) {
        roundedHour = 9;
        roundedMinute = 0;
    }
    
    const currentTime = `${roundedHour.toString().padStart(2, '0')}:${roundedMinute.toString().padStart(2, '0')}`;
    
    document.getElementById('usageDate').value = today;
    document.getElementById('usageStartTime').value = currentTime;
}

async function saveNewUsageLog() {
    const usageData = {
        equipment_name: document.getElementById('usageEquipment').value,
        user: document.getElementById('usageUser').value,
        usage_date: document.getElementById('usageDate').value,
        start_time: document.getElementById('usageStartTime').value,
        end_time: document.getElementById('usageEndTime').value,
        purpose: document.getElementById('usagePurpose').value,
        condition_after: document.getElementById('usageCondition').value,
        issues: document.getElementById('usageIssues').value
    };
    
    if (!usageData.equipment_name || !usageData.user || !usageData.usage_date || !usageData.start_time || !usageData.purpose) {
        alert('필수 항목을 모두 입력해주세요.');
        return;
    }
    
    try {
        const response = await fetch('/equipment/api/usage-logs/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(usageData)
        });
        
        const result = await response.json();
        if (result.success) {
            alert('사용일지가 저장되었습니다.');
            document.getElementById('usageLogForm').reset();
            setCurrentDateTime();
            loadUsageLogsData();
            // 모달 닫기 - 여러 방법으로 시도
            const modalElement = document.getElementById('usageLogModal');
            const modal = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
            modal.hide();
            
            // 추가로 jQuery 방식도 시도
            if (typeof $ !== 'undefined') {
                $('#usageLogModal').modal('hide');
            }
            
            // 강제로 모달 닫기
            modalElement.classList.remove('show');
            modalElement.style.display = 'none';
            document.body.classList.remove('modal-open');
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
            
            // 페이지 자동 새로고침
            setTimeout(() => {
                location.reload();
            }, 500);
        } else {
            alert('오류: ' + (result.error || '저장에 실패했습니다.'));
        }
    } catch (error) {
        console.error('사용일지 저장 중 오류:', error);
        alert('저장 중 오류가 발생했습니다.');
    }
}

function filterUsageLogs() {
    const equipment = document.getElementById('filterEquipment').value;
    const month = document.getElementById('filterMonth').value; // yyyy-MM
    loadUsageLogsDataFiltered(equipment, month);
}

async function loadUsageLogsDataFiltered(equipment, month) {
    try {
        const response = await fetch('/equipment/api/usage-logs');
        const data = await response.json();
        if (data.success) {
            // API 응답 구조에 맞게 수정: data.data.logs
            let logs = data.data?.logs || data.logs || [];
            if (equipment) {
                logs = logs.filter(log => log.equipment_name === equipment);
            }
            if (month) {
                logs = logs.filter(log => log.usage_date && log.usage_date.startsWith(month));
            }
            renderNewUsageLogTable(logs);
        }
    } catch (error) {
        console.error('사용일지 로드 중 오류:', error);
    }
}

function renderNewUsageLogTable(logs) {
    const tbody = document.getElementById('usageLogTableBody');
    let html = '';
    
    logs.forEach(log => {
        html += `
        <tr>
            <td>${log.usage_date}</td>
            <td>${log.equipment_name}</td>
            <td>${log.user}</td>
            <td>${log.start_time}</td>
            <td>${log.end_time || '-'}</td>
            <td>${log.purpose}</td>
            <td>
                <span class="status-badge ${log.condition_after === '정상' ? 'status-사용가능' : 'status-이상있음'}">
                    ${log.condition_after}
                </span>
            </td>
            <td>${log.issues || '-'}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary me-1" onclick="editUsageLog('${log.id}')">수정</button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteUsageLog('${log.id}')">삭제</button>
            </td>
        </tr>`;
    });
    
    tbody.innerHTML = html;
}

function deleteUsageLog(logId) {
    if (!confirm('정말로 이 사용일지를 삭제하시겠습니까?')) return;
    fetch(`/equipment/api/usage-logs/${logId}/delete`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(res => res.json())
    .then(result => {
        if (result.success) {
            alert('삭제되었습니다.');
            loadUsageLogsData();
            // 페이지 자동 새로고침
            setTimeout(() => {
                location.reload();
            }, 500);
        } else {
            alert('삭제 실패: ' + (result.error || '오류'));
        }
    })
    .catch(() => alert('삭제 중 오류가 발생했습니다.'));
}

function editUsageLog(logId) {
    // 해당 로그 데이터 찾기 (이미 테이블에 있으므로 logs 배열에서 찾거나, API 재호출)
    fetch('/equipment/api/usage-logs')
    .then(res => res.json())
    .then(data => {
        if (!data.success) throw new Error('데이터 로드 실패');
        // API 응답 구조에 맞게 수정: data.data.logs
        const logsList = data.data?.logs || data.logs || [];
        const log = logsList.find(l => l.id == logId);
        if (!log) throw new Error('사용일지 없음');
        // 모달 열고 값 채우기
        document.getElementById('usageEquipment').value = log.equipment_name;
        document.getElementById('usageUser').value = log.user;
        document.getElementById('usageDate').value = log.usage_date;
        document.getElementById('usageStartTime').value = log.start_time;
        document.getElementById('usageEndTime').value = log.end_time;
        document.getElementById('usagePurpose').value = log.purpose;
        document.getElementById('usageCondition').value = log.condition_after;
        document.getElementById('usageIssues').value = log.issues;
        // 저장 버튼에 수정용 핸들러 임시 부착
        const saveBtn = document.querySelector('#usageLogModal .btn-primary');
        saveBtn.onclick = function() {
            const usageData = {
                equipment_name: document.getElementById('usageEquipment').value,
                user: document.getElementById('usageUser').value,
                usage_date: document.getElementById('usageDate').value,
                start_time: document.getElementById('usageStartTime').value,
                end_time: document.getElementById('usageEndTime').value,
                purpose: document.getElementById('usagePurpose').value,
                condition_after: document.getElementById('usageCondition').value,
                issues: document.getElementById('usageIssues').value
            };
            fetch(`/equipment/api/usage-logs/${logId}/update`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(usageData)
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('수정되었습니다.');
                    document.getElementById('usageLogForm').reset();
                    loadUsageLogsData();
                    // 모달 닫기 - 여러 방법으로 시도
                    const modalElement = document.getElementById('usageLogModal');
                    const modal = bootstrap.Modal.getInstance(modalElement) || new bootstrap.Modal(modalElement);
                    modal.hide();
                    
                    // 추가로 jQuery 방식도 시도
                    if (typeof $ !== 'undefined') {
                        $('#usageLogModal').modal('hide');
                    }
                    
                    // 강제로 모달 닫기
                    modalElement.classList.remove('show');
                    modalElement.style.display = 'none';
                    document.body.classList.remove('modal-open');
                    const backdrop = document.querySelector('.modal-backdrop');
                    if (backdrop) {
                        backdrop.remove();
                    }
                    
                    // 페이지 자동 새로고침
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                } else {
                    alert('수정 실패: ' + (result.error || '오류'));
                }
            })
            .catch(() => alert('수정 중 오류가 발생했습니다.'));
        };
        // 모달 열기
        bootstrap.Modal.getOrCreateInstance(document.getElementById('usageLogModal')).show();
    })
    .catch(e => alert('수정 데이터 로드 오류: ' + e.message));
}
</script>
{% endblock %}