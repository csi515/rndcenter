# 연구개발(R&D) 센터 관리 시스템

## 개요
이 시스템은 연구개발(R&D) 센터 관리를 위해 설계된 Flask 기반 웹 애플리케이션입니다. 연구 과제, 특허, 장비, 재고, 안전관리, 구매, 커뮤니케이션 등 R&D 환경에서 필요한 다양한 기능을 제공합니다. 데이터 저장은 파일 기반 CSV 방식을 사용하여 간편성과 이식성을 높였습니다.

## 주요 변경 사항

- 2024년 6월 기준, 모든 데이터 저장은 PostgreSQL 데이터베이스를 사용합니다.
- 기존 CSV/JSON 파일(`data/` 폴더 내)은 더 이상 서비스에서 사용하지 않으며, 백업/이전 데이터 용도로만 보관합니다.
- 데이터 마이그레이션이 필요한 경우 `tools/migrate_csv_to_postgres.py` 스크립트를 사용하세요.
- CSV/JSON 파일을 직접 읽고 쓰는 코드는 모두 삭제 또는 비활성화되었습니다.

## 시스템 아키텍처

### 프론트엔드 아키텍처
- **템플릿 엔진**: Jinja2 템플릿 + Bootstrap 5 다크 테마
- **UI 프레임워크**: Bootstrap 5, Font Awesome 아이콘
- **자바스크립트 라이브러리**: FullCalendar(일정 관리), 커스텀 JS
- **반응형 디자인**: 모바일 우선, Bootstrap 그리드 시스템


### 백엔드 아키텍처
- **프레임워크**: Flask (파이썬 웹 프레임워크)
- **구조 패턴**: Blueprint 기반 모듈 구조
- **세션 관리**: 환경변수로 설정 가능한 Flask 세션
- **에러 처리**: Flash 메시지로 사용자 피드백
- **로깅**: Python logging 모듈 활용

### 데이터 저장
- **주 저장소**: 커스텀 CSVManager 클래스로 관리되는 CSV 파일
- **파일 구조**: 모든 데이터는 `/data` 폴더 내 CSV 파일로 저장
- **데이터 조작**: pandas DataFrame을 통한 CRUD
- **파일 관리**: 자동 디렉토리 생성, UTF-8 인코딩 지원

## 주요 구성 요소

### 1. 애플리케이션 코어(`app.py`)
- Flask 앱 초기화
- Blueprint 등록을 통한 모듈별 라우팅
- 세션 및 보안 설정
- 프록시 지원을 위한 WSGI 미들웨어 적용

### 2. 데이터 관리(`csv_manager.py`)
- CSVManager 클래스: 파일 입출력 담당
- DataFrame 기반 데이터 조작
- 에러 처리 및 로깅
- 추가, 수정, 조회 기능 지원

### 3. 라우트 모듈
- **대시보드**(`routes/dashboard.py`): 통계 및 최근 활동
- **연구과제**(`routes/research.py`): 과제 및 연구원 관리
- **특허**(`routes/patents.py`): 지적재산권 관리
- **장비**(`routes/equipment.py`): 장비 관리 및 예약
- **재고**(`routes/inventory.py`): 재고 관리
- **안전**(`routes/safety.py`): 사고 보고 및 안전관리
- **구매**(`routes/purchasing.py`): 구매 요청 관리
- **커뮤니케이션**(`routes/communication.py`): 내부 소통 및 Q&A
- **외부**(`routes/external.py`): 연락처 관리
- **화학물질**(`routes/chemical.py`): MSDS 및 화학물질 관리

### 4. 프론트엔드 구성
- **기본 템플릿**: 사이드바 네비게이션 포함 일관된 레이아웃
- **반응형 테이블**: 검색/필터 기능이 있는 데이터 테이블
- **모달 폼**: Bootstrap 모달을 활용한 데이터 입력
- **캘린더 연동**: FullCalendar로 일정 관리
- **인터랙티브 요소**: 자바스크립트로 사용자 경험 강화

## 데이터 흐름

### 1. 요청 처리
1. 사용자가 웹 인터페이스에서 액션을 시작
2. Flask 라우트가 HTTP 요청 처리
3. 라우트 핸들러가 폼 데이터 또는 API 호출 처리
4. CSVManager가 데이터 조작 수행
5. 결과를 템플릿 또는 JSON으로 반환

### 2. 데이터 조작
1. **생성**: 폼 제출 시 CSV에 새 레코드 추가
2. **조회**: CSV 데이터를 pandas DataFrame으로 로드해 표시
3. **수정**: 특정 행을 찾아 데이터 수정
4. **삭제**: 비활성화 표시 또는 실제 삭제

### 3. 파일 관리
- 모든 CSV 파일은 `/data` 폴더에 저장
- 파일이 없을 경우 자동 생성
- 국제 문자 지원을 위한 UTF-8 인코딩
- 인덱스 기반으로 레코드 식별 및 수정

## 외부 의존성

### 파이썬 패키지
- **Flask**: 웹 프레임워크
- **pandas**: 데이터 처리 및 분석
- **Werkzeug**: WSGI 유틸리티 및 프록시 지원

### 프론트엔드 라이브러리
- **Bootstrap 5**: 다크 테마 UI 프레임워크
- **Font Awesome 6**: 아이콘 라이브러리
- **FullCalendar 6**: 캘린더/일정 관리
- **jQuery**: Bootstrap에서 암시적으로 사용

### 파일 의존성
- `/data` 폴더 내 CSV 파일(데이터 영속성)
- 정적 파일(CSS, JS, 이미지)
- 템플릿 파일(HTML 렌더링)

## 배포 전략

### 개발 환경
- 5000번 포트에서 Flask 개발 서버 실행
- 개발용 디버그 모드 활성화
- 코드 변경 시 핫 리로딩
- 로컬 파일 기반 저장

### 운영 환경 고려사항
- WSGI 호환 배포(Gunicorn, uWSGI 등)
- 환경변수로 비밀값 관리
- ProxyFix 미들웨어로 프록시 지원
- 파일 백업 및 복구 절차

### 설정 관리
- 환경변수에서 세션 시크릿 불러오기
- 디버그 모드/호스트/포트/데이터 폴더 경로 설정 가능

## 변경 이력
- 2025년 7월 1일: 초기 세팅
- 2025년 7월 1일: PostgreSQL DB 연동 추가
  - 모든 시스템 엔터티에 대한 DB 모델 생성
  - 주간 일정 API CRUD 구현
  - 주간 일정 프론트엔드가 localStorage 대신 DB 사용하도록 변경
  - localStorage 백업 호환성 유지
  - 모든 일정 데이터가 PostgreSQL에 영구 저장, 에러 핸들링 강화
- 2025년 7월 2일: 장비 관리 시스템 고도화
  - 3탭 구조(장비 목록, 장비 예약, 사용일지)로 개편
  - 장비 등록 시 상세 필드(시리얼, 구매가, 유지보수일, 사양 등) 추가
  - 장비 상세 모달에서 정보 종합 표시
  - 실시간 폼/필터로 사용일지 작성 기능 추가
  - 구글 캘린더 스타일 예약 시스템 도입
  - 모든 장비 데이터가 PostgreSQL과 연동, API 엔드포인트 제공
  - 장비 드롭다운 로딩 오류 및 빈 상태 메시지 개선
  - 캘린더 UI 개선(밑줄 제거, 일요일 빨간색, 날짜만 표시)
  - 샘플 장비 데이터 추가
  - Equipment 모델 'notes' 필드 누락 오류 수정
  - 장비 목록/예약 페이지 간 데이터 동기화
  - 예약/사용일지 드롭다운에 모든 장비와 상태 표시
  - 장비 데이터 로딩 디버깅용 콘솔 로그 추가

## 사용자 선호
- 쉬운 일상 언어로 소통 