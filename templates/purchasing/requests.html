{% extends "base.html" %}

{% block title %}구매 관리 - R&D 센터 관리시스템{% endblock %}

{% block content %}
<div class="container-fluid py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0"><i class="fas fa-clipboard-list"></i> 구매 요청 내역</h2>
    <div class="d-flex gap-2">
      <button class="btn btn-primary" id="openRequestModalBtn"><i class="fas fa-plus"></i> 신규 구매 요청</button>
    </div>
  </div>
  <div class="card shadow-sm">
    <div class="card-header bg-secondary text-white d-flex flex-wrap justify-content-between align-items-center">
      <div class="d-flex gap-2 flex-wrap">
        <input type="text" class="form-control form-control-sm" placeholder="품목명" id="filterItem" style="width:130px;">
        <input type="text" class="form-control form-control-sm" placeholder="요청자 이름" id="filterRequester" style="width:110px;">
        <select class="form-select form-select-sm" id="filterProjectType" style="width:130px;">
          <option value="">국책과제</option>
        </select>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0" id="requestTable">
          <thead class="table-light">
            <tr>
              <th data-sort="item">품목</th><th data-sort="spec">사양</th><th data-sort="item_number">품목번호</th><th data-sort="unit">단위</th><th data-sort="project_type">국책과제</th><th data-sort="purchase_qty">구매수량</th><th data-sort="unit_price">단가</th><th data-sort="total_price">총가격</th><th data-sort="note">비고</th><th data-sort="reason">사유</th><th data-sort="requester">요청자</th><th data-sort="request_date">요청일</th><th data-sort="purchase_status">구매여부</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center">
      <div><span id="totalCount">총 0건</span></div>
    </div>
  </div>
</div>
<!-- 신규 구매 요청 모달 -->
<div class="modal fade" id="requestModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">신규 구매 요청</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="purchaseForm">
          <div class="row g-2">
            <div class="col-md-6 mb-2">
              <label class="form-label">품목</label>
              <input type="text" class="form-control" name="item" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">사양</label>
              <input type="text" class="form-control" name="spec">
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">품목 번호</label>
              <input type="text" class="form-control" name="item_number">
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">단위</label>
              <input type="text" class="form-control" name="unit">
            </div>
            <div class="col-md-12 mb-2">
              <label class="form-label">국책과제 종류</label>
              <div class="input-group">
                <select class="form-select" name="project_type" id="projectTypeSelect" required></select>
                <button type="button" class="btn btn-outline-secondary" id="manageProjectTypeBtn"><span class="me-1">⚙️</span>관리</button>
              </div>
            </div>
            <div class="col-md-4 mb-2">
              <label class="form-label">소요 수량</label>
              <input type="number" class="form-control" name="required_qty" min="0" value="0">
            </div>
            <div class="col-md-4 mb-2">
              <label class="form-label">안전 재고</label>
              <input type="number" class="form-control" name="safety_stock" min="0" value="0">
            </div>
            <div class="col-md-4 mb-2">
              <label class="form-label">구매 수량</label>
              <input type="number" class="form-control" name="purchase_qty" min="1" value="1" required id="purchaseQty">
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">단가</label>
              <input type="number" class="form-control" name="unit_price" min="0" value="0" required id="unitPrice">
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label">총 가격</label>
              <input type="text" class="form-control bg-light" name="total_price" id="totalPrice" readonly>
            </div>
            <div class="col-md-12 mb-2">
              <label class="form-label">비고</label>
              <input type="text" class="form-control" name="note">
            </div>
            <div class="col-md-12 mb-2">
              <label class="form-label">사유</label>
              <input type="text" class="form-control" name="reason">
            </div>
            <div class="col-md-12 mb-2">
              <label class="form-label">요청자</label>
              <input type="text" class="form-control" name="requester" required>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <button type="submit" class="btn btn-primary" id="submitRequestBtn">요청 등록</button>
      </div>
    </div>
  </div>
</div>
<!-- 국책과제 종류 관리 모달 -->
<div class="modal fade" id="projectTypeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">국책과제 종류 관리</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive mb-2">
          <table class="table table-sm table-bordered align-middle mb-0" id="projectTypeTable">
            <thead class="table-light">
              <tr><th>국책과제명</th><th style="width:90px;">관리</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="input-group mt-2">
          <input type="text" class="form-control" id="newProjectType" placeholder="새 국책과제 종류 입력">
          <button class="btn btn-outline-primary" id="addProjectTypeBtn"><span class="me-1">➕</span>추가</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 알림 Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index:9999">
  <div id="toastMsg" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/purchasing.js"></script>
{% endblock %}
